<!DOCTYPE html>
<html>
	<head>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
		<script type="importmap">
			{ 
				"imports": {
					"three": "https://cdn.jsdelivr.net/npm/three@0.164.0/build/three.module.js"
				} 
			}
		</script>
	</head>
	<body>
		<script type="module">
			import * as THREE from "three";
			
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.setAnimationLoop(drawFrame);
			document.body.appendChild(renderer.domElement);

			const scene = new THREE.Scene();
			scene.background = new THREE.Color("skyblue");
			
			const aspect = window.innerWidth / window.innerHeight;
			const camera = new THREE.PerspectiveCamera(30, aspect);
			camera.position.set(0, 5, 11);
			camera.lookAt(new THREE.Vector3(0, 1, 0));
			
			const light = new THREE.PointLight('white', 400);
			light.position.set(0, 8, 4);
			scene.add(light);

			let geometry = new THREE.PlaneGeometry(20, 20);
			let material = new THREE.MeshPhongMaterial({ color: "green" });
			const earth = new THREE.Mesh(geometry, material);
			earth.rotation.x = -Math.PI / 2;

			scene.add(earth);
			const build = new THREE.Group();
			scene.add(build);

			const BASE_SCALE = new THREE.Vector3(2, 2, 5);

			geometry = new THREE.BoxGeometry(BASE_SCALE.x, BASE_SCALE.y, BASE_SCALE.z);
			material = new THREE.MeshPhongMaterial({ color: "gray" });
			addToBuilding(geometry, material, 0, BASE_SCALE.y / 2);

			geometry = new THREE.BoxGeometry(BASE_SCALE.x / 2, BASE_SCALE.y + 1.5, 1);
			const leftTower = addToBuilding(geometry, material, -BASE_SCALE.x * 0.75, (BASE_SCALE.y + 1.5) / 2, BASE_SCALE.z / 2 - 0.25);

			const rightTower = leftTower.clone();
			rightTower.position.set(BASE_SCALE.x * 0.75, (BASE_SCALE.y + 1.5) / 2, BASE_SCALE.z / 2 - 0.25);
			build.add(rightTower);

			geometry = new THREE.CylinderGeometry(0, 1 / Math.sqrt(2), 1, 4, 1)
			const leftRoof = addToBuilding(geometry, material, leftTower.position.x, BASE_SCALE.y + 2, leftTower.position.z, 0, Math.PI / 4);
			
			const rightRoof = leftRoof.clone();
			rightRoof.position.x = BASE_SCALE.x * 0.75;
			build.add(rightRoof);

			geometry = new THREE.BoxGeometry(BASE_SCALE.x / Math.sqrt(2), BASE_SCALE.x / Math.sqrt(2), BASE_SCALE.z);
			addToBuilding(geometry, material, 0, BASE_SCALE.y, 0, 0, 0, Math.PI / 4);

			geometry = new THREE.BoxGeometry(BASE_SCALE.x / 3, BASE_SCALE.y / 4, 1);
			addToBuilding(geometry, material, leftTower.position.x, leftTower.position.y + BASE_SCALE.y / 8, leftTower.z - leftTower.scale.z / 2);

			function addToBuilding(geometry, material, x = 0, y = 0, z = 0, rotX = 0, rotY = 0, rotZ = 0) {
				const element = new THREE.Mesh(geometry, material);
				element.position.set(x, y, z);
				element.rotation.set(rotX, rotY, rotZ);
				build.add(element);
				return element;
			}
			
			function drawFrame(t) {
				//scene.rotation.y = t / 1000;
				renderer.render(scene, camera);
			}
		</script>
	</body>
</html>